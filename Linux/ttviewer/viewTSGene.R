#!/usr/bin/env Rscript

library(gggenes)
library(ggplot2)
options (warn = -1)

Args <- commandArgs(trailingOnly=TRUE)
geneData = read.csv(Args[1])
len_data <- nrow(geneData)
subgeneData = read.csv(Args[2])
#out = Args[3]
#name1 = gsub(".gbf","",Args[5])
#name1 = gsub(".gb","",name1)
#resu = paste(out, "/" ,Args[4], "(" ,name1, ")", "_tsg.pdf", sep = "")
if(len_data == 11){geneData$Exon <- factor(geneData$Exon, levels=c('exon1', 'exon2 (IRa)', 'exon3 (IRa)', 'exon2 (IRb)', 'exon3 (IRb)'))}else if(len_data == 7){geneData$Exon <- factor(geneData$Exon, levels=c('exon1', 'exon2 (IRa)', 'exon2 (IRb)'))}else if(len_data == 3){geneData$Exon <- factor(geneData$Exon, levels=c('exon1', 'exon2', 'exon3'))}else if(len_data == 2){geneData$Exon <- factor(geneData$Exon, levels=c('exon1', 'exon2'))}
if(len_data == 11){cddPalette <- c("#808080","#FFFFFF","#FFFFFF","#000000","#000000")}else if(len_data == 7){cddPalette <- c("#808080","#FFFFFF","#000000")}else if(len_data == 5){cddPalette <- c("#000000","#FFFFFF")}else if(len_data == 3){cddPalette <- c("#FFFFFF","#808080","#000000")}else if(len_data == 2){cddPalette <- c("#FFFFFF","#000000")}
if(len_data == 11){cl <- c("#FFFFFF","#000000","#000000","#000000","#000000","#FFFFFF","#FFFFFF","#FFFFFF","#FFFFFF","#FFFFFF","#FFFFFF")}else if(len_data == 7){cl <- c("#FFFFFF","#000000","#000000","#FFFFFF","#FFFFFF","#FFFFFF","#FFFFFF")}else if(len_data == 5){cl <- c("#FFFFFF","#FFFFFF","#000000","#FFFFFF","#000000")}else if(len_data == 3){cl <- c("#000000","#FFFFFF","#FFFFFF")}else if(len_data == 2){cl <- c("#000000","#FFFFFF")}

if(len_data == 11){pdf(Args[3], width=6.27,height=2.32)}else if(len_data == 7){pdf(Args[3], width=6.27,height=2.32)}else if(len_data == 5){pdf(Args[3], width=6.27,height=2)}else if(len_data == 3){pdf(Args[3], width=6.27,height=1.8)}else if(len_data == 2){pdf(Args[3], width=6.27,height=1.8)}
if(len_data == 11){ggplot(geneData, aes(xmin = start, xmax = end, y = strand,label = strand,fill = Exon,forward = direction))+geom_hline(yintercept = c(subgeneData$strand),color = "white",size = 1,linetype ="dotted") + geom_gene_arrow() +geom_gene_label(colour = cl,aes(label = label_label)) + facet_wrap(~ Gene, scales = "free", ncol = 1) + scale_x_continuous(breaks = c(geneData$start,geneData$end),labels =c(geneData$label_from,geneData$label_to))+ scale_y_discrete(name="\nTrans-splicing Genes\n") + theme(axis.title.y=element_text(size=8)) + theme(axis.ticks.y=element_blank())+ theme(strip.text.x = element_blank()) +  theme(plot.title = element_text(hjust = 0.5,lineheight=0.8)) + scale_fill_manual(values = cddPalette) +theme_genes() + theme(axis.text.x=element_text(angle = 16,size = 5,hjust=0.5, vjust=0.5)) + theme(legend.title = element_text(colour='white')) + guides(colour = guide_legend(order = 2),shape = guide_legend(order = 1))}else if(len_data == 7){ggplot(geneData, aes(xmin = start, xmax = end, y = strand,label = strand,fill = Exon,forward = direction))+geom_hline(yintercept = c(subgeneData$strand),color = "white",size = 1,linetype ="dotted") + geom_gene_arrow() +geom_gene_label(colour = cl,aes(label = label_label)) + facet_wrap(~ Gene, scales = "free", ncol = 1) + scale_x_continuous(breaks = c(geneData$start,geneData$end),labels =c(geneData$label_from,geneData$label_to))+ scale_y_discrete(name="\nTrans-splicing Genes\n") + theme(axis.title.y=element_text(size=8)) + theme(axis.ticks.y=element_blank())+ theme(strip.text.x = element_blank()) +  theme(plot.title = element_text(hjust = 0.5,lineheight=0.8)) + scale_fill_manual(values = cddPalette) +theme_genes() + theme(axis.text.x=element_text(angle = 16,size = 5,hjust=0.5, vjust=0.5)) + theme(legend.title = element_text(colour='white')) + guides(colour = guide_legend(order = 2),shape = guide_legend(order = 1))}else if(len_data == 5){ggplot(geneData, aes(xmin = start, xmax = end, y = strand,label = strand,fill = Exon,forward = direction))+geom_hline(yintercept = c(subgeneData$strand),color = "white",size = 1,linetype ="dotted") + geom_gene_arrow() +geom_gene_label(colour = cl,aes(label = label_label)) + facet_wrap(~ Gene, scales = "free", ncol = 1) + scale_x_continuous(breaks = c(geneData$start,geneData$end),labels =c(geneData$label_from,geneData$label_to))+ scale_y_discrete(name="\nTrans-splicing Genes\n") + theme(axis.title.y=element_text(size=8)) + theme(axis.ticks.y=element_blank())+ theme(strip.text.x = element_blank()) +  theme(plot.title = element_text(hjust = 0.5,lineheight=0.8)) + scale_fill_manual(values = cddPalette) +theme_genes() + theme(axis.text.x=element_text(angle = 16,size = 5,hjust=0.5, vjust=0.5)) + theme(legend.title = element_text(colour='white')) + guides(colour = guide_legend(order = 2),shape = guide_legend(order = 1))}else if(len_data == 3){ggplot(geneData, aes(xmin = start, xmax = end, y = strand,label = strand,fill = Exon,forward = direction))+ geom_gene_arrow() +geom_gene_label(colour = cl,aes(label = label_label)) + facet_wrap(~ Gene, scales = "free", ncol = 1) + scale_x_continuous(breaks = c(geneData$start,geneData$end),labels =c(geneData$label_from,geneData$label_to))+ scale_y_discrete(name="\nTrans-splicing Genes\n") + theme(axis.title.y=element_text(size=8)) + theme(axis.ticks.y=element_blank())+ theme(strip.text.x = element_blank()) +  theme(plot.title = element_text(hjust = 0.5,lineheight=0.8)) + scale_fill_manual(values = cddPalette) +theme_genes() + theme(axis.text.x=element_text(angle = 16,size = 5,hjust=0.5, vjust=0.5)) + theme(legend.title = element_text(colour='white')) + guides(colour = guide_legend(order = 2),shape = guide_legend(order = 1))}else if(len_data == 2){ggplot(geneData, aes(xmin = start, xmax = end, y = strand,label = strand,fill = Exon,forward = direction))+ geom_gene_arrow() +geom_gene_label(colour = cl,aes(label = label_label)) + facet_wrap(~ Gene, scales = "free", ncol = 1) + scale_x_continuous(breaks = c(geneData$start,geneData$end),labels =c(geneData$label_from,geneData$label_to))+ scale_y_discrete(name="\nTrans-splicing Genes\n") + theme(axis.title.y=element_text(size=8)) + theme(axis.ticks.y=element_blank())+ theme(strip.text.x = element_blank()) +  theme(plot.title = element_text(hjust = 0.5,lineheight=0.8)) + scale_fill_manual(values = cddPalette) +theme_genes() + theme(axis.text.x=element_text(angle = 16,size = 5,hjust=0.5, vjust=0.5)) + theme(legend.title = element_text(colour='white')) + guides(colour = guide_legend(order = 2),shape = guide_legend(order = 1))}
dev.off()
print("---  Pdf file has been generated, please check the folder under the current file!  ---")
